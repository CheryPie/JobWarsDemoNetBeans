<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Log In</title>
        <script type="text/javascript" src="js/jquery-2.1.3.min.js"></script>
        <link rel="stylesheet" type="text/css" href="css/login.css">
        <script>

            function forward() {
                $.ajax({
                    url: 'rest/user',
                    type: "GET",
                    dataType: "text",
                    statusCode: {
                        200: function (data) {
                            console.log(data);
                            window.location.href = data;
                        }}
                });
            }
            $(document).mouseup(function (e)
            {
                var container = $("#register");
                var x = $("#close");

                if (!container.is(e.target) // if the target of the click isn't the container...
                        && container.has(e.target).length === 0) // ... nor a descendant of the container
                {
                    container.fadeOut();
                }
            });
            function showRegButtons() {
                $("#register").fadeIn();
            }

            function fade() {
                var container = $("#register");
                container.fadeOut();
            }

            function login() {

                alert("called");
                var username = $("#userName")[0].value;
                var password = $("#pass")[0].value;

                if (username == "" || password == "") {
                    alert("Username and password should not be empty.");
                    return;
                }

                var data = {
                    password: password,
                    userName: username//,
                            //  company: null,
                            //jobSeeker: null,
                            //  loginUserRole: null

                };

                console.log(data.password)
                console.log(data.userName)

                $.ajax({
                    url: 'rest/user/login',
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    data: JSON.stringify(data),
                    // dataType: "json",
                    statusCode: {
                        401: function () {
                            alert("Authentication failed");
                            console.log("Authentication failed");
                        },
                        200: function () {
                            alert("Authentication succeded");
                            console.log("Authentication succeded");
                            forward();
                        }
                    }
                });
            }
        </script>
    </head>
    <body>
        <div id="logoContainer"></div>
        <form role="form" method="post">
            <table>
                <tr>     
                    <td>
                        <input type="text" name="username" id="userName" placeholder="потрeбител">
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="password" name="password" id="pass" placeholder="парола">
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <span id="buttons">
                            <button onclick="login()" type="button">Вход</button>
                            <button type="button" id="show_reg" onclick="showRegButtons();">Регистрация</button>
                        </span>
                    </td>
                </tr>
            </table>
        </form>
        <div id="register">
            <div id="close" onclick="fade()">х</div>
            <h1>Добре дошли в света на JobWars!</h1>
            <div id="form">
                <div class="regType">
                    <h2>Предлагам работа</h2>
                    <img src="img/company_reg.png" width="126" height="157">
                    <p>Намери най-добрите кандидати<br/>за твоята фирма!</p>
                    <button type="button" onclick="location.href = 'register_company.html';">Намери кандидати</button>
                </div>
                <div class="regType">
                    <span class="vertical-line"></span>
                    <p id="or">или</p>
                    <span class="vertical-line"></span>
                </div>
                <div class="regType">
                    <h2>Търся работа</h2>
                    <img src="img/seeker_reg.png" width="126" height="157">
                    <p>Намери най-доброто<br/>работно място!</p>
                    <button type="button" onclick="location.href = 'register_seeker.html';">Намери работа</button>
                </div>
            </div>
        </div>
        <footer>
            <div id="copyright">
                <hr/>
                <ul id="cLink">
                    <li><a href="">Home</a></li>
                    <li><a href="">About</a></li>
                </ul>
            </div>
        </footer>
    </body>
</html>